```
::::::::: ::::::::  :::    :::     :::     :::::::::  :::::::::  :::::::::: ::::::::::: 
     :+: :+:    :+: :+:    :+:   :+: :+:   :+:    :+: :+:    :+: :+:            :+:     
    +:+  +:+        +:+    +:+  +:+   +:+  +:+    +:+ +:+    +:+ +:+            +:+     
   +#+   +#+        +#++:++#++ +#++:++#++: +#++:++#:  +#+    +:+ +#++:++#       +#+     
  +#+    +#+        +#+    +#+ +#+     +#+ +#+    +#+ +#+    +#+ +#+            +#+     
 #+#     #+#    #+# #+#    #+# #+#     #+# #+#    #+# #+#    #+# #+#            #+#     
######### ########  ###    ### ###     ### ###    ### #########  ##########     ###     
```

Port of [uchardet](https://www.freedesktop.org/wiki/Software/uchardet/)
character encoding library to the [Zig Build System](https://ziglang.org/learn/build-system/).

The [Zig language](https://ziglang.org/) is a modern systems programming
language with almost transparent "C" interop. It features a build system that
can be used to cross-compile C and C++, so it makes sense to use Zig purely as a
build system, even if the project does not contain Zig code beyond de
`build.zig` file. See [this article](https://kristoff.it/blog/maintain-it-with-zig/).

This is why this repository contains a Zig build file that generates two artifacts:

1. A static build of the uchardet "C" library.
2. A thin Zig API for better ergonomic use with Zig.
3. A (very minimal) test suite.

I see this as a minimal example of what integrating a C library in Zig might
look like.

Requirements
============

- Needs Zig 0.12
- Tested with zig-windows-x86_64-0.12.0-dev.2613+0266017b5

Building
========

To build it just enter the directory and run

```
zig build
```

or 

```
zig build test --summary all
```

All standard build options should work (untested). Once done, the `C` library
will be built and you can integrate it with the rest of your toolchain, even if
it is not consumed from `Zig`.

Using as a Depencency with Zon
==============================

Zon is the (still experimental) official package manager for .ZIG. This project
builds with the current main branch version of Zig/Zon.

To use it in your own project, you need to include the dependency in your
zig.zon file, either manually or with, eg:

```
zig fetch https://github.com/jarnaldich/zchardet/archive/refs/heads/main.tar.gz --save=zchardet
```

The `build.zig.zon` file will look something like:

```
...
    .dependencies = .{
        // we depend on the duck package described in B
        .zchardet = .{
           .url = "https://github.com/jarnaldich/zchardet/archive/refs/heads/main.tar.gz",
           .hash = "...",
        },
    },
... 
```

Another option with the 0.12 relase is to manage the download and dependency in
source form (eg. through a GIT submodule), and then use the path instead of a
url. This might be more convenient for development:

```
...
    .dependencies = .{
        // we depend on the duck package described in B
        .zchardet = .{
           .path = "deps/zchardet"
        },
    },
...
```

*Note*: At the moment I am not providing a release for the package, but I can do
so if requested, in which case I will provide the hash for comparison in this
README file.

Once this is done, you are free to use the dependency by importing the module in
your `build.zig`, for example to integrate it in an executable like the one in
the autogenerated `zig init` build file:

```
...
    const zchardet_dep = b.dependency("zchardet", .{
        .target = target,
        .optimize = optimize,
    });
    exe.root_module.addImport("zchardet", zchardet_dep.module("zchardet"));
...
```

Then you can already use it in your source file. The API is very straightforward
and mimicks the C API, using a `struct` to close over an opaque pointer. Eg:

```
const zcd = @import("zchardet");

pub fn main() !void {
...
    const cd = try zcd.ZCharDet.init();
    defer cd.deinit();

    try cd.handle_data("DATA");
    cd.data_end();

    const enc = cd.get_encoding(0);
    const confidence = cd.get_confidence(0);


    std.debug.print("File encoding: {s} with confidence: {}\n", .{ enc, confidence });
...
}

```

Disclaimer
==========

Zig is a moving target, APIs are changing constantly, especially regarding the
package manager and build system, so this repo may get outdated. Patches
welcome.

Also, use at your own risk...
